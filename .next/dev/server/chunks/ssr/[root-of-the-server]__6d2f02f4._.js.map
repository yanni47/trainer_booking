{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 30, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jursa/OneDrive/Desktop/booking-web-page/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nif (!supabaseUrl || !supabaseAnonKey) {\n  throw new Error('Missing Supabase environment variables');\n}\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Types matching the database schema\nexport type Booking = {\n  id: string;\n  trainer_id: string;\n  client_id: string;\n  status: 'pending' | 'confirmed' | 'cancelled';\n  title: string | null;\n  notes: string | null;\n  token: string;\n  created_at: string;\n  confirmed_at: string | null;\n};\n\nexport type BookingSlot = {\n  id: string;\n  booking_id: string;\n  proposed_time: string;\n  is_selected: boolean;\n  created_at: string;\n};\n\nexport type Client = {\n  id: string;\n  trainer_id: string;\n  name: string;\n  email: string;\n  phone: string | null;\n  notes: string | null;\n  created_at: string;\n};\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,2OAAY,EAAC,aAAa"}},
    {"offset": {"line": 49, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/styles/Book.module.css [ssr] (css module)"],"sourcesContent":["__turbopack_context__.v({\n  \"card\": \"Book-module__lxIKhG__card\",\n  \"clientName\": \"Book-module__lxIKhG__clientName\",\n  \"confirmedDate\": \"Book-module__lxIKhG__confirmedDate\",\n  \"confirmedHour\": \"Book-module__lxIKhG__confirmedHour\",\n  \"confirmedTime\": \"Book-module__lxIKhG__confirmedTime\",\n  \"container\": \"Book-module__lxIKhG__container\",\n  \"error\": \"Book-module__lxIKhG__error\",\n  \"errorIcon\": \"Book-module__lxIKhG__errorIcon\",\n  \"header\": \"Book-module__lxIKhG__header\",\n  \"loading\": \"Book-module__lxIKhG__loading\",\n  \"notes\": \"Book-module__lxIKhG__notes\",\n  \"notesLabel\": \"Book-module__lxIKhG__notesLabel\",\n  \"notesText\": \"Book-module__lxIKhG__notesText\",\n  \"sessionInfo\": \"Book-module__lxIKhG__sessionInfo\",\n  \"sessionTitle\": \"Book-module__lxIKhG__sessionTitle\",\n  \"slotButton\": \"Book-module__lxIKhG__slotButton\",\n  \"slotDate\": \"Book-module__lxIKhG__slotDate\",\n  \"slotLoading\": \"Book-module__lxIKhG__slotLoading\",\n  \"slotNumber\": \"Book-module__lxIKhG__slotNumber\",\n  \"slotTime\": \"Book-module__lxIKhG__slotTime\",\n  \"slotsList\": \"Book-module__lxIKhG__slotsList\",\n  \"spin\": \"Book-module__lxIKhG__spin\",\n  \"spinner\": \"Book-module__lxIKhG__spinner\",\n  \"subtitle\": \"Book-module__lxIKhG__subtitle\",\n  \"success\": \"Book-module__lxIKhG__success\",\n  \"successIcon\": \"Book-module__lxIKhG__successIcon\",\n  \"successNote\": \"Book-module__lxIKhG__successNote\",\n  \"title\": \"Book-module__lxIKhG__title\",\n});\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/jursa/OneDrive/Desktop/booking-web-page/pages/book/%5Btoken%5D.tsx"],"sourcesContent":["import { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport { supabase, type Booking, type BookingSlot, type Client } from '../../lib/supabase';\nimport { format, parseISO } from 'date-fns';\nimport styles from '../../styles/Book.module.css';\n\ntype BookingWithDetails = Booking & {\n  client: Client;\n  booking_slots: BookingSlot[];\n};\n\nexport default function BookingPage() {\n  const router = useRouter();\n  const { token } = router.query;\n\n  const [booking, setBooking] = useState<BookingWithDetails | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [selecting, setSelecting] = useState(false);\n  const [selectedSlotId, setSelectedSlotId] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    if (!token || typeof token !== 'string') return;\n\n    loadBooking(token);\n  }, [token]);\n\n  async function loadBooking(bookingToken: string) {\n    try {\n      setLoading(true);\n      setError(null);\n\n      // Fetch booking by token\n      const { data, error: fetchError } = await supabase\n        .from('bookings')\n        .select(`\n          *,\n          client:clients(*),\n          booking_slots(*)\n        `)\n        .eq('token', bookingToken)\n        .single();\n\n      if (fetchError || !data) {\n        setError('Booking not found');\n        return;\n      }\n\n      // Check if already confirmed\n      if (data.status === 'confirmed') {\n        setError('This booking has already been confirmed');\n        setBooking(data as BookingWithDetails);\n        return;\n      }\n\n      if (data.status === 'cancelled') {\n        setError('This booking has been cancelled');\n        return;\n      }\n\n      setBooking(data as BookingWithDetails);\n    } catch (err) {\n      console.error('Error loading booking:', err);\n      setError('Something went wrong');\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  async function selectSlot(slotId: string) {\n  console.log('üîµ START selectSlot');\n  console.log('üîµ slotId:', slotId);\n  console.log('üîµ booking:', booking);\n  \n  if (!booking) {\n    console.log('üî¥ No booking!');\n    return;\n  }\n\n  try {\n    console.log('üîµ Setting selecting = true');\n    setSelecting(true);\n    setSelectedSlotId(slotId);\n\n    console.log('üîµ Calling Supabase update...');\n    \n    const { data, error: updateError } = await supabase\n      .from('booking_slots')\n      .update({ is_selected: true })\n      .eq('id', slotId);\n\n    console.log('üîµ Supabase response:', { data, error: updateError });\n\n    if (updateError) {\n      console.error('üî¥ Update error:', updateError);\n      setError('Failed to confirm booking. Please try again.');\n      setSelectedSlotId(null);\n      return;\n    }\n\n    console.log('‚úÖ Update successful!');\n    console.log('üîµ Reloading booking...');\n\n    if (token && typeof token === 'string') {\n      await loadBooking(token);\n    }\n\n    console.log('‚úÖ Done!');\n  } catch (err) {\n    console.error('üî¥ Exception:', err);\n    setError('Something went wrong');\n    setSelectedSlotId(null);\n  } finally {\n    setSelecting(false);\n  }\n}\n\n  if (loading) {\n    return (\n      <div className={styles.container}>\n        <div className={styles.loading}>\n          <div className={styles.spinner}></div>\n          <p>Loading...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error && !booking) {\n    return (\n      <div className={styles.container}>\n        <div className={styles.error}>\n          <div className={styles.errorIcon}>‚ö†Ô∏è</div>\n          <h2>{error}</h2>\n          <p>Please contact your trainer if this is an error.</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (booking?.status === 'confirmed') {\n    const confirmedSlot = booking.booking_slots.find((s) => s.is_selected);\n    return (\n      <div className={styles.container}>\n        <div className={styles.success}>\n          <div className={styles.successIcon}>‚úì</div>\n          <h1>Booking Confirmed!</h1>\n          <p className={styles.clientName}>Hi {booking?.client?.name},</p>\n          <p>Your session has been confirmed for:</p>\n          {confirmedSlot && (\n            <div className={styles.confirmedTime}>\n              <p className={styles.confirmedDate}>\n                {format(parseISO(confirmedSlot.proposed_time), 'EEEE, MMMM d, yyyy')}\n              </p>\n              <p className={styles.confirmedHour}>\n                {format(parseISO(confirmedSlot.proposed_time), 'h:mm a')}\n              </p>\n            </div>\n          )}\n          {booking?.title && (\n            <p className={styles.sessionTitle}>{booking?.title}</p>\n          )}\n          <p className={styles.successNote}>You're all set! See you then.</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.card}>\n        <div className={styles.header}>\n          <h1 className={styles.title}>Choose Your Time</h1>\n          <p className={styles.subtitle}>Hi {booking?.client?.name}!</p>\n          {booking?.title && (\n            <p className={styles.sessionInfo}>Session: {booking?.title}</p>\n          )}\n        </div>\n\n        <div className={styles.slotsList}>\n          {booking?.booking_slots\n            ?.sort((a, b) => \n              new Date(a.proposed_time).getTime() - new Date(b.proposed_time).getTime()\n            )\n            .map((slot, index) => (\n              <button\n                key={slot.id}\n                className={styles.slotButton}\n                onClick={() => {\n                console.log('üü¢ BUTTON CLICKED!', slot.id);\n                selectSlot(slot.id);\n}}\n                disabled={selecting}\n              >\n                <div className={styles.slotNumber}>Option {index + 1}</div>\n                <div className={styles.slotDate}>\n                  {format(parseISO(slot.proposed_time), 'EEEE, MMMM d')}\n                </div>\n                <div className={styles.slotTime}>\n                  {format(parseISO(slot.proposed_time), 'h:mm a')}\n                </div>\n                {selecting && selectedSlotId === slot.id && (\n                  <div className={styles.slotLoading}>\n                    <div className={styles.spinner}></div>\n                  </div>\n                )}\n              </button>\n            ))}\n        </div>\n\n        {booking?.notes && (\n          <div className={styles.notes}>\n            <p className={styles.notesLabel}>Notes from your trainer:</p>\n            <p className={styles.notesText}>{booking.notes}</p>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}